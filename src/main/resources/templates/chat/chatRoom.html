<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<input type="text" placeholder="보낼 메세지를 입력하세요." class="content">
<button type="button" value="전송" class="sendBtn" onclick="sendMsg()">전송</button>
<button type="button" value="방나가기" class="quit" onclick="quit()">방 나가기 </button>
<div>
  <span>메세지</span>
  <div class="msgArea"></div>
</div>
</body>

<script th:inline="javascript">
  function enterRoom(socket){

    socket.send("입장하였습니다.");
  }

  function quietRoom(socket){
    socket.send("퇴장하였습니다.");
  }

  const roomId = [[${roomId}]];
  const userName = [[${userName}]];
  let socket = new WebSocket(`ws://localhost:8080/ws/chat?roomId=${roomId}&userName=${userName}`);

  socket.onopen = function (e) {
    console.log('open server!')
    enterRoom(socket);
  };
  socket.onclose=function(e){
    console.log('disconnet');
    quietRoom(socket);
  }

  socket.onerror = function (e){
    console.error(e);
  }

  socket.onmessage = function (e) {
    console.log(e.data);
    let msgArea = document.querySelector('.msgArea');
    let newMsg = document.createElement('div');
    newMsg.innerText=e.data;
    msgArea.append(newMsg);
  }

  function sendMsg() {
    let content=document.querySelector('.content').value;

    socket.send(JSON.stringify(content));
  }

  function quit(){
    socket.close();
    location.href="/chat/chatList";
  }

</script>

</html>